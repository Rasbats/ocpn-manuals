<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Untitled :: OpenCPN Manuals</title>
    <link rel="canonical" href="https://rasbats.github.io/ocpn-manuals/opencpn-beta-plugins/0.1/deviation/deviation.html">
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../_/css/site.css">
<link rel="icon" href="../../../_/img/favicon.ico" type="image/x-icon">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <div class="navbar">
    <div class="navbar-brand">
      <div class="ocpn-logo"> </div>
      <a class="navbar-title"
         href="https://rasbats.github.io/ocpn-manuals"
      >
        OpenCPN Manuals
        </a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
       <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="https://www.opencpn.org/">
                OpenCPN.org
              </a>
              <a class="navbar-item" href="https://opencpn.org/wiki/dokuwiki/doku.php?id&#x3D;opencpn:opencpn_user_manual
">
                User Manual
              </a>
              <a class="navbar-item" href="https://github.com/opencpn/OpenCPN">
                Github Site
              </a>
              <a class="navbar-item" href="https://opencpn.org/flyspray/">
                Bugtracker
              </a>
              <a class="navbar-item" href="https://rasbats.github.io/opencpn-plugins-manual/">
                Plugin Manual (WIP)
              </a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="opencpn-beta-plugins" data-version="0.1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">OpenCPN Beta Plugins</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../index.html">Home Page</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../beta-plugins.html">Beta Plugins</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">OpenCPN Beta Plugins</span>
    <span class="version">0.1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">OpenCPN Beta Plugins</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../ocpn-dev-manual/5.3.1/index.html">OpenCPN Developer Manual</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../ocpn-dev-manual/5.3.1/index.html">5.3.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../manuals/0.1/index.html">OpenCPN Manuals</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../manuals/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../opencpn-master-plugins/0.1/index.html">OpenCPN Plugins</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../opencpn-master-plugins/0.1/index.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../otcurrent/0.1/otcurrent.html">otcurrent</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../otcurrent/0.1/otcurrent.html">0.1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../shipdriver/0.1/shipdriver.html">ShipDriver</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../shipdriver/0.1/shipdriver.html">0.1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../../manuals/0.1/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
</nav>
  <div class="edit-this-page"><a href="https://github.com/Rasbats/ocpn-manuals/edit/manual/plugins/manual-beta/modules/deviation/pages/deviation.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<div class="sect1">
<h2 id="_deviation"><a class="anchor" href="#_deviation"></a>Deviation</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="_images/deviation-4-table.png" alt="deviation 4 table"></span></p>
</div>
<div class="paragraph">
<p>Typical Deviation Table for a Magnetic Compass</p>
</div>
<div class="sect2">
<h3 id="_links"><a class="anchor" href="#_links"></a>Links</h3>
<div class="ulist">
<ul>
<li>
<p>Source: <a href="https://github.com/RooieDirk/Deviation_pi">Github RooieDirk
Deviation_pi Repository</a></p>
</li>
<li>
<p>Releases: <a href="https://github.com/RooieDirk/Deviation_pi/releases">Github
RooieDirk Deviation_pi Releases</a></p>
</li>
<li>
<p>Forum:
<a href="http://www.cruisersforum.com/forums/f134/compass-deviation-plugin-future-requests-187912.html">Cruiser&#8217;s
Forum - Compass Deviation Thread</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_goals"><a class="anchor" href="#_goals"></a>Goals</h3>
<div class="paragraph">
<p><a href="assets/deviation-compass.doc">Draft Functional Specifications by Ozwingle</a></p>
</div>
<div class="paragraph">
<p>(Coefficients are not mentioned only because I am not knowledgeable enough to clearly describe them.
However, including coefficients appears to be a good idea, as you have already done.)</p>
</div>
<div class="paragraph">
<p>Provide <strong>Compass Course (CC)</strong> calculated from
<em>True-Variation-Magnetic-Deviation-Compass (TVMDC)</em> values. Provide for
entry of a <strong>Deviation Table</strong>. Since OpenCPN 'knows' True and Variation
(from WMM plugin), with <strong>Deviatio</strong>n we can have the <strong>Compass course to
steer</strong>. Possibly integrate some of the functionality into OpenCPN core
with WMM_pi.</p>
</div>
<div class="paragraph">
<p>While working on a new Compass Deviation plugin, What there is now:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Possible to use multiple compasses on multiple ships</p>
</li>
<li>
<p>Make your one <strong>Deviation Table</strong> by taking Compass Bearings. (Als sun&#8217;s
azimuth possible)</p>
</li>
<li>
<p>TO DO but on my list is re-sending a nmea headg (HDG) sentence
including True North Course.</p>
</li>
<li>
<p>Production of a <strong>Table of Coefficient</strong></p>
</li>
<li>
<p>Show additional curves for each bearing with an offset of +-1 degree
error</p>
</li>
<li>
<p>Print the <strong>Deviation Table</strong>.</p>
</li>
<li>
<p>For <strong>Dead Reckoning</strong> Mode (no GPS available) a Compass Course (CC) is
needed in OpenCPN.</p>
</li>
<li>
<p>Possible separation of developing a deviation table(s) plugin from
automating the creation of deviation tables (swinging a compass). A
plugin that provides a compass course from known deviation tables would
be immediately useful and it simplifies the development process and will
become available sooner perhaps.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A cellphone does have a fluxgate sensor just as most electronic
compasses on board. And most fluxgate sensors are nowadays 3D that means
they are actually three sensors (for x,y and z directions). A fluxgate
is a way to measure magnetic field strength. For a compass we can forget
about the z direction.</p>
</div>
<div class="paragraph">
<p>If we have a compass on board our ship, the reading is likely to be
influenced by the ships own magnetic field. Think of this ships magnetic
field as being a magnetic of some strength and in some direction. What
an electronic compass does if the <strong>auto compensate</strong> feature is 'on',
while steaming in a circle, measure the strength of the magnetic field.
The field that is measured is the combination of earth and ships field.
It is clear that if ships field and earth field are working in the same
direction, the resulting total field will be high. Also if working in
opposite direction the result will be low. Then the Compass computer
starts calculating and makes an internal <strong>Correction Table</strong> based on the
high and low course and a sinewave like correction between them. From
then on it takes the compass readings, adds the <strong>Correction</strong> and outputs
the <strong>Corrected Compass Course</strong>.</p>
</div>
<div class="paragraph">
<p>This works rather well for a lot of circumstances. But it could be that
the ships magnetic field is equal or even stronger then the earth field.
Then it is not possible to calulate a correction table. (your compass
will warn you to find another place for the sensor). And especially on
steel ships there is something like 'induced magnetic'. This is if the
earth magnetic field 'sea&#8217;s' a iron bar then, as the iron bar is a
better magnetic conductor then air, the earth field will run trough the
bar. Unfortunately we have now a bar with on one side magnetic field
'lines' going in and the other side coming out. ** that IS a magnet.
Only a magnet not constant and even changing N/S poles on different
courses.</p>
</div>
<div class="paragraph">
<p>Self Compensating Fluxgate compasses can&#8217;t correct for these induced
fields. Then there is still the Z direction. As long the vessel is
upright this won&#8217;t do anything to the compass reading. If sailing
however it will cause a heeling error. And again an auto compensate
can&#8217;t fix this.</p>
</div>
<div class="paragraph">
<p>If you '<strong>Compensate</strong>' (with magnets) a compass, or only make a
'<strong>Deviation Table</strong>', you need the true ships course (some way or
another) and compare this with the compass reading.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The modern way is bring your own GPS compass, but a gyro will also do.
Most of us won&#8217;t have either of them, so we need something else.</p>
</li>
<li>
<p>A very good and accurate one is the sun (if you have a correct time).
A good compass will have a shadow pin to make it easy to take a sun
bearing. But a thin line with a small weight could also throw a nice
shadow line over the compass rose. A leading line (lights) is also a
good true course if you steam right into it.</p>
</li>
<li>
<p>What I often use is OpenCPN. Make a route to a point some distance
away. Make a heading straight to that point and compare the compass
course with the true course.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In my Plugin (in progress) all three could be used and the PI will take
care of the calculation and drawing of the deviation table. Dirk</p>
</div>
<div class="paragraph">
<p>Thanks for the specs. We are more or less on one line. As a point from
your doc it will make it easier to add from an existing deviation table.</p>
</div>
<div class="sect3">
<h4 id="_calculations"><a class="anchor" href="#_calculations"></a>Calculations</h4>
<div class="paragraph">
<p>About your remarks about curve fitting and sine wave, the deviation is
always a result of the formula</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-code hljs" data-lang="code">Dev=A + B.sin(CC) + C.cos(CC) + D.sin(2.CC) + E.cos(2.CC).
Where CC is Compass Course and A to E constant values.</code></pre>
</div>
</div>
<div class="paragraph">
<p>I do curve fitting following above formula and calculate the A..E
values. In the preview the Curve including original points are visible,
so you can see how accurate your input is/was.</p>
</div>
</div>
<div class="sect3">
<h4 id="_future_opencpn_core_code"><a class="anchor" href="#_future_opencpn_core_code"></a>Future OpenCPN Core Code?</h4>
<div class="paragraph">
<p>Having the compass course in the route steering popup window is in the
core code, and can&#8217;t be changed from the plugin. But maybe in the future
it is possible to merge with the variation plugin. Then it would be a
standard addon for OpenCPN and the core code setting for
magnetic-readings could be changed in compass-readings.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_requirements"><a class="anchor" href="#_requirements"></a>Requirements</h3>

</div>
<div class="sect2">
<h3 id="_documentation"><a class="anchor" href="#_documentation"></a>Documentation</h3>
<div class="paragraph">
<p><span class="image"><img src="_images/deviation-1.png" alt="deviation 1"></span></p>
</div>
<div class="paragraph">
<p>First Menu, Enter Ship and Compass Name</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/deviation-2.png" alt="deviation 2"></span></p>
</div>
<div class="paragraph">
<p>Enter Compass Bearing and True Bearing</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="_images/deviation-3.png" alt="deviation 3"></span></p>
</div>
<div class="paragraph">
<p>Calculation of Deviation Table and Graph</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_user_guide"><a class="anchor" href="#_user_guide"></a>User Guide</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_what_and_why"><a class="anchor" href="#_1_what_and_why"></a>1. What and Why</h3>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>What does the pi do B. Why can the pi be useful</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_2_install"><a class="anchor" href="#_2_install"></a>2. Install</h3>
<div class="olist upperalpha">
<ol class="upperalpha" type="A">
<li>
<p>Where to get the pi B. How to install the pi</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_standard_actions"><a class="anchor" href="#_3_standard_actions"></a>3. Standard actions</h3>
<div class="paragraph">
<p>What are basic (standard) actions you have to do to make the pi work
Example: “how to set up a Watchdog Alarm”.</p>
</div>
</div>
<div class="sect2">
<h3 id="_4_options"><a class="anchor" href="#_4_options"></a>4. Options</h3>
<div class="paragraph">
<p>What options are there after performing the standard actions Examples:
1. Choice for a specific type of Watchdog Alarm (anchor, boundary,
speed, course, deadman, NMEA etc.) 2. Choice for a specific type of
alarm-signal (pop-up message, sound, command) 3. Setting various
parameters (range in meters, degrees, time in seconds or minutes, speed
etc.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_5_faq"><a class="anchor" href="#_5_faq"></a>5. FAQ</h3>
<div class="paragraph">
<p>Will this plugin help determine the deviation, or is it just for making
the corrections? Will the compass indications include deviation with the
assumption we are using a magnetic compass rather than a GPS compass?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The plan is both. For a regular compass it will help to make a
deviation table on paper. (in theory taking as less as 5 bearings should
be enough) And for an electronic (nmea) compass it can, in cooperation
with the variation PI, correct the magnetic course up to a true course.
Mind you, an electronic compass with auto compensation doesn&#8217;t mean that
the deviation is zero. It has, just as an ordinary compass has, a
remaining deviation after compensation.</p>
</li>
<li>
<p>Need to be a little careful here or one could get a false sense of
accuracy. Only 5 compass errors will not allow a deviation table to be
made. We need the vessel to be heading on all the cardinal points,
North, South, East and West. And also the inter-cardinals, NE, SE, SW,
NW, as a minimum, taking the deviation on each heading. Recording the
deviation on courses within about 5 degrees of each of those headings
will not affect the result too much. So perhaps build up the information
but not allow the table to be made until the minimum number of readings
have been taken.</p>
</li>
<li>
<p>A useful addition could be the production of a Table of Coefficients.
If you see an 'A' coefficient this would indicate a lubber line not
aligned with the fore and aft line of the boat.</p>
</li>
<li>
<p>Agreed, 5 is the theoretic mathematical minimum., but for praxis the
more the better and at least in every quadrant. I do show the
coefficients. (see last picture) I believe it is a good idea to show
additional curves for each bearing with an offset of +-1 degree error.
That should give a nice idea of the accuracy of the result.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Wouldn&#8217;t a cellphone be useful to calibrate a compass? Their Compass
often requires calibration by twisting in 3 directions?</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A cellphone will be of no help. Compass deviation is caused by the
vessels own magnetism.</p>
</li>
<li>
<p>By compensating you try to add a few magnets that will be just as
strong but in opposite direction then the ships magnetism. The ships
magnetism influence will be different for each place onboard. This means
if you have a movable compass you cant compensate it.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>What I try to do is allow to take bearings to a known point (is known
bearing), and so find the misreading of the compass. The misreading is
deviation + variation.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>For a known bearing you could choose from a leading line(lights), a
fixed point or a bearing of the sun.</p>
</li>
<li>
<p>George Winthur our compass adjuster uses an electric gyroscope to
adjust our Ritche magnetic compass by comparisons. He got it close
enough to call it zero deviation but we&#8217;ve removed an alu housing for
old radar around the pedestal so it must be checked.</p>
</li>
<li>
<p>Furthermore, while deviation can be reduced by 'correction' as
Rooiedirk describes, it cannot be completed eliminated. Maybe it can be
-0- on one or a few headings, but there will be some residual deviation
on other headings. Thus a deviation table for each compass that is used
for navigation or piloting is required. Being careful with stowage can
help reduce deviation and random changes in deviation, e.g. don&#8217;t stow
tinned foods near the fluxgate compass.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_6_resources_sources"><a class="anchor" href="#_6_resources_sources"></a>6. Resources &amp; Sources</h3>
<div class="paragraph">
<p><a href="http://www.capecompass.com/analysis_explained.php">Cape Compass:Compass
Deviation Analysis Explained</a></p>
</div>
<div class="paragraph">
<p>Far more detail here:</p>
</div>
<div class="paragraph">
<p><a href="http://msi.nga.mil/MSISiteContent/StaticFiles/HoMCA.pdf">Handbook of
Magnetic Compass Adjustment</a></p>
</div>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.
     Sources: https://gitlab.com/leamas/antora-ui-default
  </p>
</footer>
<script src="../../../_/js/site.js"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
